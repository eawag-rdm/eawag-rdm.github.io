<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>CKAN for Research Data Management at Eawag: A report from the trenches</title>
  <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui"> -->
  <link rel="stylesheet" href="css/reveal.css">
  <link rel="stylesheet" href="css/theme/white.css">
  <!-- Code syntax highlighting -->
  <link rel="stylesheet" href="lib/css/zenburn.css">
  <link rel="stylesheet" href="css/theme/eawag.css"
  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script>
  <!--[if lt IE 9]>
  <script src="lib/js/html5shiv.js"></script>
  <![endif]-->
</head>

<body>
<div class="reveal">
<div class="slides">
  <img class="logo" src="assets/eaw-rdm1_inv.png"/>
  
  <!-- Title -->
  <section data-background="assets/eawag_vorlage_blau_background.png" data-state="title">
    <div class="full">
      <div class="maintitle_l1">
	<img style="vertical-align:-12px;" class="rawimg" src="assets/ckanlogo.png" />
	for Research Data Management<br />
	at Eawag
      </div>
      <div class="maintitle_l2">
	&mdash;  a report from the trenches &mdash;
      </div>
      <div style="margin-top:600px;">CKANCon 2016</div>
      <div class="authordate">
	Harald von Waldow &lt;harald.vonwaldow@eawag.ch&gt; &mdash; 2016-10-04
      </div>
    </div>
  </section>

  <!-- The Project -->
  <section>
    <section>
      <h1>The <i class="alert">Project</i></h1>
    </section>
    <section>
      <p class="lonesectitle"><h3>Establish
      an <i class="alert">institution-wide</i>, <i class="alert">central</i>
      research data repository</h3></p>
      <ul>
	<li><mark>Compliance</mark> with Guidelines for Good Scientific Practice<br />(e.g., reproducibility, retention obligation)
	<li><mark>Archival</mark> of unique unrepeatable measurements<br />(&asymp; everything in the environment)</li>
	<li><mark> Data discovery</mark> and <mark>collaboration</mark><br />
	  across working groups, departments (and institutions).</li>
      </ul>
    </section>
    <section>
      <div class="rightcolumn">
      	<img class="rawimg" src="assets/forum-chriesbach.jpg" />
	<img class="rawimg" src="assets/kb.jpg" />
      </div>
      <div class="leftcolumn">
	<blockquote style="margin-top:120px;">Eawag is concerned with concepts and technologies
	  for dealing sustainably with water bodies and with water as a
	  resource.</blockquote>
	<ul style="margin-top:120px;">
	  <li>&sim; 500 staff in research, teaching and consulting</li>
	  <li>12 research departments</li>
	  <li>&sim; 70 research groups</li>
	</ul>
      </div>
    </section>
    <section>
      <p class="lonesectitle"><h4>A very <span class="alert">heterogeneous</span> data-mixture</h4></p>
      <div class="rightcolumn" style="margin-top:30px">
	&nbsp;
	<ul class="fragment">
	  <li><mark>file-sizes: kB - 100s of GB</mark></li>
	  <li><mark>#files per package: 1 - 100s</mark></li>
	  <li>analysis scripts</li>
	  <li>CSV, PDF, baroque Excel files</li>
	  <li>binary data-logger output</li>
	  <li>photographs, movies</li>
	  <li>...</li>
	</ul>
      </div>
      <div class="leftcolumn" style="margin-top:30px;text-align:left;">
	<b class="exampletext">e.g.</b>
	  <ul>
	    <li>high performance<br />mass-spectrometry</li>
	    <li>genomics & transcriptomics</li>
	    <li>hydrologic data</li>
	    <li>species counts</li>
	    <li>urban drainage<br />sensor networks</li>
	    <li>surveys & questionnaires</li>
	    <li>simulation results</li>
	  </ul>
      </div>
    </section>
    <section>
      <div class="rightcolumn">
	<img class="rawimg" src="assets/package.png" width="65%"/>
	<div style="margin-top:70px;" class="fragment" data-fragment-index="1">
	  <img class="rawimg" src="assets/bunker.jpg" width="70%"/>
	</div>
      </div>
      <div class="leftcolumn">
	<p class="lonesectitle"><h4>Characteristics of <span class="alert">Packages</span> (= "<i>datasets</i>")</h4></p>
	<ul>
	  <li><mark>publication packages</mark></li>
	  <li>raw data</li>
	  <li>the workgroup "stock-data"</li>
	</ul>
	<div class="fragment" data-fragment-index="1">
	  <p class="lonesectitle"><h4><span class="alert">Time horizons</span> for storage</h4></p>
	  <ul>
	    <li>mid-term: &sim; 10 years</li>
	    <li>long-term: &sim; 100 years</li>
	  </ul>
	</div>
      </div>
    </section>
    <section>
      <div class="full"> 
	<img class="rawimg" src="assets/ecosystem.png" />
      </div>
    </section>
  </section>
  
  <!-- The Challenge -->
  <section>
    <section>
	  <h1>The <i class="alert">Challenge</i></h1>
    </section>
    <section>
      <div class="rightcolumn" style="margin-right:-80px;">
	<div style="text-align:left;" class="fragment">
	  <img class="rawimg" width="75%" src="assets/scientists.jpg">
	  <mark>submission process:</mark><br />
	  <ul class="condensed">
	    <li>quick </li>
	    <li>simple</li>
	    <li>intuitive</li>
	  </ul><br />
	  &rHar; ...
	</div>
      </div>
      <div class="leftcolumn">
	<img class="rawimg" src="assets/librarian.jpg">
	<div style="text-align:left;">
	  <mark>result:</mark><br />
	  <ul class="condensed">
	    <li>well annotated</li>
	    <li>good file formats</li>
	    <li>complete</li>
	    <li>consistent</li>
	  </ul>
	</div>
      </div>
    </section>
  </section>
  
  <!-- Data submission -->
  <section>
    <section>
      <h1>Amendments for<br /><i class="alert">data submission</i></h1>
    </section>
    <section>
      <h4 class="lonesectitle"><span class="alert">ckanext-scheming</span> is the thing!</h4>
      <p align="left"><span class="exampletext">small amendments</span></p>
      <div class="rightcolumn">
	<img src="assets/help_default.png" class="rawimg" />
	<img src="assets/taxa.png" data-fragment-index="1" class="rawimg fragment" />
	<img src="assets/flags.png" data-fragment-index="2"class="rawimg fragment" />
	<pre data-fragment-index="2" class="fragment">eaw_schema_conditional_multicheck.js</pre>
      </div>
      <div class="leftcolumn">
	<ul style="position:relative;top:-40px;">
	  <li>extensive help-modals</li>
	  <li>(dynamic) default values</li>
	  <li>ckanext-repeating<mark>.js</mark><br />[lcrnz-repeating.js]</li>
	  <li data-fragment-index="1"class="fragment">line-by-line textareas</li>
	  <li data-fragment-index="2"class="fragment">checkbox array with constraints</li>
	</ul>
      </div>
    </section>
    <section>
      <h4 class="lonesectitle"><span class="alert">ckanext-scheming</span> is still the thing!</h4>
      <p align="left"><span class="exampletext">more involved amendments</span><br />&nbsp;<br />
	Use the <mark>SOLR DateRange field</mark>
      </p>
      <div style="float:left;">
	<pre style="width:100%;">def vali_daterange(values)
validate_solr_daterange.py</pre>
      </div>
      <div style="float:right;">
	<img src="assets/timerange.png" class="rawimg" />
      </div>
      <div class="fragment">
	<p style="clear:both;text-align:left;"><mark>Index JSON</mark> - store string</p>
	<div style="float:left;">
	  <pre style="width:115%;">
def eaw_schema_multiple_string_convert(typ)

@scheming_validator
def eaw_schema_multiple_choice(field, schema)

#IPackageController
def before_index(self, pkg_dict)</pre>
	</div>
	<div style="float:right">
	  <pre style="width:100%"><code class="python">
json2list_fields = [
  'substances',
  'variables',
  'systems'
  'timerange',
  'taxa',]</code></pre> 
	</div>
      </div>
    </section>
    <section>
      <h4 class="lonesectitle"><span class="alert">Client</span> side scripts</h4>
      <p align="left">
       <span class="exampletext">resup.py [-h] {put,get,list,del} ...</span>
	<ul class="condensed">
	  <li>Batch upload of resources to data package in CKAN.</li>
	  <li>Batch download and deletion from data package in CKAN.</li>
	</ul>
      </p>
      <p align="left">
	<b><a href="https://github.com/eawag-rdm/resup">resup</a></b> handles compression, creation of a tar-archive,
	checksumming, splitting of large files for upload, and
	re-assemblage of thusly split files upon download.
      </p><p align="left">
	Resources to be downloaded or deleted can be specified by
	providing a regular expression to select resource names.
      </p>
    </section>
    <section>
      <h4 class="lonesectitle">Large TODO-item: <span class="alert">georeferencing</span></h4>
      <div class="rightcolumn fragment">
	<img src="assets/florianm_spatial.png" class="rawimg"/>
	<div>
	  <img src="assets/florianm.png" width="100px" class="rawimg" align="middle"/>
	  <a style="position:relative;top:-60px;" href="https://github.com/ckan/ckanext-spatial/pull/93">ckanext-spatial/pull/93</a>
	</div>
      </div>
      <div class="leftcolumn" style="position:relative;top:-60px;">
	<img class="rawimg" src="assets/spatial.png" />
	<ul class="condensed">
	  <li>copy & paste coordinates</li>
	  <li>accept lat/lon, lon/lat, CH1903, CH1903+, ...</li>
	  <li>parse degrees minutes (seconds) into decimal degrees</li>
	  <li>graphical selection of locations</li>
	  <li>points <mark>and</mark> lines <mark>and</mark> polygons</li>
	</ul>
      </div>
    </section>
    <section>
      <h4 class="lonesectitle">Large TODO-item: <span class="alert">versioning</span></h4>
      <p align="left"><b>package level</b>: <span class="exampletext">http://.../dataset/history/&lt;name&gt;</span></p>
      <div style="text-align:left;">
	<ul class="condensed">
	  <li>Is this going to stay? (currently undocumented)</li>
	  <li>Is there a <mark>rollback</mark>-extension?</li>
	</ul>
      </div>
      <br />
      <div class="fragment">
	<p align="left"><b>resource level</b>: <span class="exampletext">nothing implemented yet?</span></p>
	<div style="text-align:left;">
	  <mark>Idea</mark>: Add resource_fields:<br />
	  <ul class="condensed">
	    <li><span style="font-family:monospace;font-size:30px;">supersedes: &lt;resource_id&gt;</span></li>
	    <li><span style="font-family:monospace;font-size:30px;">version: &lt;maj.min.pat&gt;</span></li>
	  </ul>
	</div>
      </div>
    </section>
  </section>

  <!-- Amendements for search interface -->
  <section>  
    <section>
      <h1>Amendments for the<br /><i class="alert">search interface</i></h1>
    </section>
    <section>
      <h4 class="lonesectitle"><span class="alert">Field specific</span> search</h4>
      <div style="float:left;">
	<img src="assets/specific_search.png" class="rawimg" />
      </div>
      <ul class="condensed fragment" data-fragment-index="1">
	<li><pre style="width:100%;">IPackageController:before_search</pre></li>
	<li>parse custom search_params</li>
	<li>into SOLR search-string</li>
      </ul>
      <p style="clear:both;"></p>
      <pre class="fragment" data-fragment-index="1"><code data-trim data-noescape>
def mk_field_queries(search_params):
    '''
    Customizes the fq-search-string so that query-terms
    referring to the same <field> (e.g. "example_field") are combined
    with logic operator taken from the value of OP_<field>,
    e.g. "OP_example_field". Default for this operator is "AND" to
    keep compatibility. The other possible value is "OR".
    OP_<field> is removed from the querystring.
    '''
      </code></pre>
    </section>
  </section>
  <section>
    <section>
      <h1>A <span class="alert">modest</span> proposal</h1>
    </section>
    <section>
      <h4 class="lonesectitle">Future <span class="alert">CKAN development</span> could</h4>
      <ul>
	<li>integrate <span class="exampletext">ckanext-scheming</span> into core</li>
        <li>eliminate special (aka "core") fields<br />
	  (provide a default <span class="exampletext">scheming.json</span> instead.)</li>
	<li>streamline handling of <mark>structured schema items</mark></li>
	<li>foster a <mark>"scheming-library"</mark> of plugins and snippets</li>
      </ul>
    </section>
  </section>
  <section>
    <section>
      <div class="full" style="background:white;">
      	<h1><span class="alert">Q</span>uestions?</h1>
      	<br />
      	<img class="rawimg" width="50%" src="assets/cartoon.png" />
      </div>
    </section>
  </section>
</div>

<!-- ####################################################################### -->
<!-- ####################################################################### -->
<!-- ####################################################################### -->
    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>
    <script>
      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Vertical centering of slides
        center: true,
        // Turns fragments on and off globally
        fragments: true,
        // Transition style
        transition: 'convex', // none/fade/slide/convex/concave/zoom
        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1024,
        height: 768,
        //width: 1090,
        //height:1200,
        // Factor of the display size that should remain empty around the content
        margin: 0.03,
        zoomKey: 'shift',
        // Optional reveal.js plugins
      dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true },
          { src: 'plugin/notes/notes.js', async: true }
        ]
      });
    </script>
  </body>
</html>
